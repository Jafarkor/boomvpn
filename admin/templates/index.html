<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VPN Admin</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
/* â”€â”€ Design tokens â”€â”€ */
:root {
  --bg:    #09090e;
  --s1:    #0f1117;
  --s2:    #161820;
  --s3:    #1c1f2b;
  --b:     #21253a;
  --b2:    #2a2f45;
  --acc:   #6366f1;
  --acc2:  rgba(99,102,241,.14);
  --grn:   #10b981;
  --grn2:  rgba(16,185,129,.12);
  --ylw:   #f59e0b;
  --ylw2:  rgba(245,158,11,.12);
  --red:   #ef4444;
  --red2:  rgba(239,68,68,.12);
  --txt:   #e8eaf0;
  --txt2:  #9197ae;
  --txt3:  #555e7a;
  --r:     10px;
  --r2:    14px;
  --side:  220px;
  --trans: .18s ease;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; overflow: hidden; }
body {
  background: var(--bg);
  color: var(--txt);
  font: 13.5px/1.55 'Inter', system-ui, sans-serif;
  -webkit-font-smoothing: antialiased;
}
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--b2); border-radius: 8px; }

/* â”€â”€ Login â”€â”€ */
#login {
  display: flex; align-items: center; justify-content: center;
  height: 100vh;
  background: radial-gradient(ellipse 70% 50% at 50% -5%, #1a1960 0%, var(--bg) 70%);
}
.lcard {
  background: var(--s1); border: 1px solid var(--b);
  border-radius: 20px; padding: 44px 36px;
  width: min(380px, 92vw); text-align: center;
  box-shadow: 0 40px 80px rgba(0,0,0,.55), 0 0 0 1px rgba(99,102,241,.08);
}
.lcard-ico { font-size: 46px; line-height: 1; margin-bottom: 16px; }
.lcard h1 { font-size: 21px; font-weight: 700; margin-bottom: 6px; }
.lcard p  { color: var(--txt2); font-size: 13px; margin-bottom: 28px; }
.linput {
  width: 100%; padding: 12px 14px;
  background: var(--s2); border: 1px solid var(--b);
  border-radius: 9px; color: var(--txt); font: inherit;
  font-size: 14px; outline: none; margin-bottom: 10px;
  transition: border-color var(--trans);
}
.linput:focus { border-color: var(--acc); }
.lbtn {
  width: 100%; padding: 13px; background: var(--acc);
  color: #fff; border: none; border-radius: 9px;
  font: 600 14px 'Inter', system-ui;
  cursor: pointer; transition: opacity var(--trans), transform var(--trans);
}
.lbtn:hover { opacity: .88; }
.lbtn:active { transform: scale(.99); }
.lerr { color: var(--red); font-size: 12px; margin-top: 10px; min-height: 18px; }

/* â”€â”€ App shell â”€â”€ */
#app { display: none; height: 100vh; overflow: hidden; }
.shell { display: flex; height: 100vh; overflow: hidden; }

/* â”€â”€ Sidebar â”€â”€ */
.side {
  width: var(--side); flex-shrink: 0;
  background: var(--s1); border-right: 1px solid var(--b);
  display: flex; flex-direction: column;
  transition: transform .24s ease; z-index: 50;
}
.brand {
  padding: 20px 16px 16px;
  display: flex; align-items: center; gap: 10px;
  border-bottom: 1px solid var(--b);
}
.brand-ico  { font-size: 26px; flex-shrink: 0; }
.brand-name { font-size: 14px; font-weight: 700; }
.brand-sub  { font-size: 9px; color: var(--txt3); letter-spacing: .1em; text-transform: uppercase; margin-top: 1px; }
nav { flex: 1; padding: 10px 8px; overflow-y: auto; }
.nav-sec {
  font-size: 9px; color: var(--txt3); text-transform: uppercase;
  letter-spacing: .1em; padding: 14px 9px 5px;
}
.ni {
  display: flex; align-items: center; gap: 9px;
  padding: 9px 10px; border-radius: 8px;
  cursor: pointer; color: var(--txt2);
  font-size: 13px; font-weight: 500;
  transition: background var(--trans), color var(--trans);
  margin-bottom: 1px; white-space: nowrap;
}
.ni:hover { background: var(--s2); color: var(--txt); }
.ni.on    { background: var(--acc2); color: var(--acc); }
.ni .ic   { width: 18px; text-align: center; font-size: 14px; flex-shrink: 0; }
.side-foot { padding: 12px 10px; border-top: 1px solid var(--b); }
.out-btn {
  width: 100%; padding: 9px 12px; border-radius: 8px;
  background: transparent; border: 1px solid var(--b);
  color: var(--txt2); cursor: pointer;
  font: 12px 'Inter', system-ui;
  transition: border-color var(--trans), color var(--trans);
  display: flex; align-items: center; justify-content: center; gap: 6px;
}
.out-btn:hover { border-color: var(--red); color: var(--red); }

/* â”€â”€ Mobile overlay â”€â”€ */
.side-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.6); z-index: 40; }

/* â”€â”€ Main â”€â”€ */
.main { flex: 1; display: flex; flex-direction: column; overflow: hidden; min-width: 0; }
.topbar {
  padding: 11px 18px;
  background: var(--s1); border-bottom: 1px solid var(--b);
  display: flex; align-items: center; gap: 12px; flex-shrink: 0;
}
.menu-btn {
  display: none; background: none; border: none;
  color: var(--txt); font-size: 18px; cursor: pointer;
  padding: 2px 6px; line-height: 1; flex-shrink: 0;
}
.topbar h1 { font-size: 15px; font-weight: 600; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.status-dot {
  display: flex; align-items: center; gap: 5px;
  background: var(--grn2); color: var(--grn);
  border-radius: 20px; padding: 4px 11px;
  font-size: 11px; font-weight: 600; flex-shrink: 0;
}
.status-dot::before { content: ''; width: 6px; height: 6px; background: var(--grn); border-radius: 50%; }
.view { flex: 1; overflow-y: auto; padding: 20px; -webkit-overflow-scrolling: touch; }

/* â”€â”€ Stats grid â”€â”€ */
.sg { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 12px; margin-bottom: 18px; }
.sc {
  background: var(--s1); border: 1px solid var(--b);
  border-radius: var(--r2); padding: 18px 16px;
  position: relative; overflow: hidden;
  transition: border-color var(--trans);
}
.sc:hover { border-color: var(--b2); }
.sc::before {
  content: ''; position: absolute;
  top: 0; left: 0; right: 0; height: 2px; border-radius: 2px 2px 0 0;
}
.sc.p::before { background: var(--acc); }
.sc.g::before { background: var(--grn); }
.sc.y::before { background: var(--ylw); }
.sc.r::before { background: var(--red); }
.sc-emoji { font-size: 22px; margin-bottom: 10px; line-height: 1; }
.sl { font-size: 10px; color: var(--txt3); text-transform: uppercase; letter-spacing: .07em; margin-bottom: 6px; }
.sv { font-size: 26px; font-weight: 700; letter-spacing: -.5px; margin-bottom: 3px; }
.ss { font-size: 11px; color: var(--txt2); }

/* â”€â”€ Charts â”€â”€ */
.cg { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 18px; }
.cc { background: var(--s1); border: 1px solid var(--b); border-radius: var(--r2); padding: 18px; }
.ct { font-size: 12px; font-weight: 600; color: var(--txt2); margin-bottom: 14px; }

/* â”€â”€ Table card â”€â”€ */
.tc { background: var(--s1); border: 1px solid var(--b); border-radius: var(--r2); overflow: hidden; }
.tb { padding: 14px 16px; border-bottom: 1px solid var(--b); display: flex; flex-direction: column; gap: 10px; }
.tb-top { display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap; }
.tb-top h2 { font-size: 14px; font-weight: 600; white-space: nowrap; }
.tb-count { color: var(--txt3); font-size: 13px; font-weight: 400; margin-left: 6px; }
.tb-row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

/* â”€â”€ Filter panel â”€â”€ */
.fp {
  background: var(--s2); border: 1px solid var(--b); border-radius: var(--r);
  padding: 14px; display: flex; gap: 12px; flex-wrap: wrap; align-items: flex-end;
}
.fg { display: flex; flex-direction: column; gap: 5px; min-width: 0; }
.fg label { font-size: 10px; color: var(--txt3); text-transform: uppercase; letter-spacing: .07em; }
.date-range { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
.date-range span { font-size: 11px; color: var(--txt3); }

/* â”€â”€ Form controls â”€â”€ */
.si, .fsel, .di {
  background: var(--s2); border: 1px solid var(--b);
  border-radius: 8px; color: var(--txt); font: inherit;
  outline: none; transition: border-color var(--trans); -webkit-appearance: none;
}
.si   { padding: 8px 11px; font-size: 13px; }
.fsel { padding: 8px 11px; font-size: 13px; cursor: pointer; }
.di   { padding: 7px 10px; font-size: 12px; cursor: pointer; }
.si:focus, .fsel:focus, .di:focus { border-color: var(--acc); }
.di::-webkit-calendar-picker-indicator { filter: invert(.4); cursor: pointer; }

/* â”€â”€ Buttons â”€â”€ */
.btn {
  padding: 7px 13px; border-radius: 8px; border: none;
  cursor: pointer; font: 600 12.5px 'Inter', system-ui;
  transition: all var(--trans);
  display: inline-flex; align-items: center; gap: 5px;
  white-space: nowrap; -webkit-tap-highlight-color: transparent;
}
.btn:disabled { opacity: .38; cursor: not-allowed; }
.btn:not(:disabled):active { transform: scale(.97); }
.btn-acc  { background: var(--acc2); color: var(--acc); border: 1px solid rgba(99,102,241,.25); }
.btn-acc:hover:not(:disabled)  { background: rgba(99,102,241,.22); }
.btn-grn  { background: var(--grn2); color: var(--grn); border: 1px solid rgba(16,185,129,.25); }
.btn-grn:hover:not(:disabled)  { background: rgba(16,185,129,.2); }
.btn-red  { background: var(--red2); color: var(--red); border: 1px solid rgba(239,68,68,.25); }
.btn-red:hover:not(:disabled)  { background: rgba(239,68,68,.2); }
.btn-d    { background: transparent; color: var(--txt2); border: 1px solid var(--b); }
.btn-d:hover:not(:disabled)    { color: var(--txt); border-color: var(--b2); }
.btn-primary { background: var(--acc); color: #fff; border: 1px solid var(--acc); }
.btn-primary:hover:not(:disabled) { opacity: .88; }
.btn-lg   { padding: 11px 22px; font-size: 13.5px; border-radius: 9px; }
.btn-sm   { padding: 5px 10px; font-size: 11.5px; border-radius: 6px; }
.btn-icon { padding: 7px 9px; }
.btn-full { width: 100%; justify-content: center; }

/* â”€â”€ Search â”€â”€ */
.search-wrap { display: flex; gap: 6px; flex: 1; min-width: 0; }
.search-wrap .si { flex: 1; min-width: 0; }

/* â”€â”€ Filter toggle â”€â”€ */
.ftgl {
  display: flex; align-items: center; gap: 5px;
  padding: 7px 12px; border-radius: 8px;
  border: 1px solid var(--b); background: transparent;
  color: var(--txt2); cursor: pointer;
  font: 500 12.5px 'Inter', system-ui;
  transition: all var(--trans); white-space: nowrap; flex-shrink: 0;
}
.ftgl:hover, .ftgl.on { border-color: var(--acc); color: var(--acc); background: var(--acc2); }
.f-count { background: var(--acc); color: #fff; border-radius: 10px; padding: 1px 6px; font-size: 9.5px; margin-left: 2px; }

/* â”€â”€ Filter chips â”€â”€ */
.af-chips { display: flex; gap: 6px; flex-wrap: wrap; }
.afc {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 3px 10px; background: var(--acc2);
  border: 1px solid rgba(99,102,241,.2);
  border-radius: 20px; font-size: 11px; color: var(--acc); white-space: nowrap;
}
.afc button { background: none; border: none; color: var(--acc); cursor: pointer; font-size: 12px; padding: 0; line-height: 1; opacity: .6; margin-left: 2px; }
.afc button:hover { opacity: 1; }

/* â”€â”€ Table â”€â”€ */
.table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
table { width: 100%; border-collapse: collapse; min-width: 480px; }
thead th {
  font-size: 10px; color: var(--txt3);
  text-transform: uppercase; letter-spacing: .07em;
  padding: 10px 14px; text-align: left;
  border-bottom: 1px solid var(--b); white-space: nowrap;
  background: var(--s2);
}
td {
  padding: 11px 14px; font-size: 12.5px;
  border-bottom: 1px solid rgba(30,33,52,.7); vertical-align: middle;
}
tr:last-child td { border-bottom: none; }
tbody tr { transition: background var(--trans); }
tbody tr:hover td { background: rgba(255,255,255,.017); }
.empty-row td { text-align: center; color: var(--txt3); padding: 44px; font-size: 13px; }

/* â”€â”€ Badges â”€â”€ */
.bd {
  display: inline-flex; align-items: center; border-radius: 20px;
  padding: 2px 9px; font-size: 10px; font-weight: 600; white-space: nowrap;
}
.bd.g { background: var(--grn2); color: var(--grn); }
.bd.r { background: var(--red2); color: var(--red); }
.bd.y { background: var(--ylw2); color: var(--ylw); }
.bd.p { background: var(--acc2); color: var(--acc); }
.bd.d { background: rgba(100,116,139,.1); color: var(--txt2); }

.acts     { display: flex; gap: 4px; flex-wrap: nowrap; }
.sub-col  { display: flex; flex-direction: column; gap: 2px; }
.sub-days { font-size: 10px; color: var(--txt3); }

/* â”€â”€ Pagination â”€â”€ */
.pg { display: flex; align-items: center; justify-content: center; gap: 4px; padding: 14px; flex-wrap: wrap; }
.pb {
  padding: 5px 11px; background: var(--s2); border: 1px solid var(--b);
  border-radius: 7px; color: var(--txt2); cursor: pointer;
  font: 12px 'Inter', system-ui; transition: all var(--trans);
  -webkit-tap-highlight-color: transparent;
}
.pb:hover { border-color: var(--acc); color: var(--acc); }
.pb.on    { background: var(--acc); border-color: var(--acc); color: #fff; }
.pb:disabled { opacity: .3; cursor: not-allowed; }
.ptxt { font-size: 12px; color: var(--txt3); padding: 0 3px; }

/* â”€â”€ Modal â”€â”€ */
.ov {
  position: fixed; inset: 0;
  background: rgba(0,0,0,.72); z-index: 200;
  display: flex; align-items: flex-end; justify-content: center;
  backdrop-filter: blur(4px); padding: 0;
  animation: fadeIn .15s ease;
}
@keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
.mo {
  background: var(--s1); border: 1px solid var(--b);
  border-radius: 18px 18px 0 0;
  padding: 22px 22px 32px; width: 100%;
  max-width: 580px; max-height: 90vh;
  overflow-y: auto; box-shadow: 0 -12px 50px rgba(0,0,0,.45);
  animation: slideUp .18s ease;
}
@keyframes slideUp { from { transform: translateY(20px); opacity: .6 } to { transform: none; opacity: 1 } }
.mo-handle { width: 36px; height: 3px; background: var(--b2); border-radius: 4px; margin: 0 auto 18px; }
.mo-head { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 18px; }
.mo-title { font-size: 16px; font-weight: 700; }
.mo-sub   { font-size: 12px; color: var(--txt2); margin-top: 2px; }
.mo-x {
  background: var(--s2); border: 1px solid var(--b);
  color: var(--txt2); cursor: pointer; border-radius: 7px;
  width: 28px; height: 28px; display: flex; align-items: center;
  justify-content: center; font-size: 14px; flex-shrink: 0;
  transition: all var(--trans);
}
.mo-x:hover { border-color: var(--txt2); color: var(--txt); }
.ir {
  display: flex; justify-content: space-between; align-items: center;
  padding: 10px 0; border-bottom: 1px solid rgba(30,33,52,.9);
  font-size: 13px; gap: 12px;
}
.ir:last-child { border-bottom: none; }
.il { color: var(--txt2); flex-shrink: 0; }
.iv { font-weight: 500; max-width: 260px; word-break: break-all; text-align: right; font-size: 12px; }
.mo-act { display: flex; gap: 8px; margin-top: 22px; flex-wrap: wrap; }
.mo-sect {
  font-size: 10px; font-weight: 600; color: var(--txt3);
  margin: 18px 0 9px; text-transform: uppercase; letter-spacing: .07em;
}
.mini-t {
  width: 100%; border-collapse: collapse;
  border: 1px solid var(--b); border-radius: 8px; overflow: hidden;
  font-size: 11.5px;
}
.mini-t th {
  font-size: 9.5px; color: var(--txt3); text-transform: uppercase;
  padding: 8px 10px; background: var(--s2); text-align: left; letter-spacing: .05em;
}
.mini-t td { padding: 8px 10px; border-top: 1px solid var(--b); }

/* â”€â”€ Confirm modal â”€â”€ */
.confirm-ico { font-size: 38px; text-align: center; margin-bottom: 14px; }
.confirm-msg { text-align: center; color: var(--txt2); font-size: 13px; margin-bottom: 22px; line-height: 1.7; }
.mo-btns { display: flex; gap: 10px; justify-content: center; }
.chk-row {
  display: flex; align-items: center; gap: 9px;
  justify-content: center; font-size: 12.5px; color: var(--txt2);
  margin-bottom: 20px; cursor: pointer;
}
.chk-row input { accent-color: var(--acc); width: 14px; height: 14px; cursor: pointer; }

/* â”€â”€ Broadcast â”€â”€ */
.bpage { max-width: 660px; }
.bpage h2 { font-size: 16px; font-weight: 700; margin-bottom: 4px; }
.bpage .hint { color: var(--txt2); font-size: 12.5px; margin-bottom: 20px; }
.bcast-ta {
  width: 100%; min-height: 130px;
  background: var(--s2); border: 1px solid var(--b); border-radius: 10px;
  padding: 13px; color: var(--txt); font: 13.5px 'Inter', system-ui;
  outline: none; resize: vertical;
  transition: border-color var(--trans); margin-bottom: 16px; line-height: 1.55;
}
.bcast-ta:focus { border-color: var(--acc); }
.aud-label { font-size: 10px; color: var(--txt3); text-transform: uppercase; letter-spacing: .08em; margin-bottom: 10px; }
.aud-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(190px, 1fr)); gap: 8px; margin-bottom: 18px; }
.aud-card {
  padding: 13px 14px; background: var(--s2);
  border: 1.5px solid var(--b); border-radius: 10px;
  cursor: pointer; transition: all var(--trans);
}
.aud-card:hover { border-color: var(--b2); }
.aud-card.sel   { border-color: var(--acc); background: var(--acc2); }
.aud-name  { font-size: 13px; font-weight: 600; margin-bottom: 3px; }
.aud-desc  { font-size: 11px; color: var(--txt2); line-height: 1.4; }
.aud-count { font-size: 12px; font-weight: 700; color: var(--acc); margin-top: 6px; }
.bcast-footer { display: flex; align-items: center; gap: 14px; flex-wrap: wrap; }
.bcast-total  { font-size: 13px; color: var(--txt2); }
.bcast-total b { color: var(--txt); }
.bcast-ok {
  margin-top: 14px; padding: 13px 16px;
  background: var(--grn2); border: 1px solid rgba(16,185,129,.22);
  border-radius: 9px; color: var(--grn); font-size: 13.5px;
}

/* â”€â”€ Loading / toast â”€â”€ */
.ld { display: flex; align-items: center; justify-content: center; padding: 56px; color: var(--txt2); gap: 10px; }
.sp { width: 17px; height: 17px; border: 2px solid var(--b2); border-top-color: var(--acc); border-radius: 50%; animation: spin .65s linear infinite; flex-shrink: 0; }
@keyframes spin { to { transform: rotate(360deg) } }
#toast {
  position: fixed; bottom: 20px; right: 16px;
  background: var(--s2); border: 1px solid var(--b); border-radius: 10px;
  padding: 11px 18px; font-size: 13px; z-index: 999;
  transform: translateY(70px); opacity: 0;
  transition: all .24s ease; pointer-events: none;
  max-width: calc(100vw - 32px); box-shadow: 0 8px 24px rgba(0,0,0,.3);
}
#toast.show { transform: translateY(0); opacity: 1; }
#toast.ok  { border-color: rgba(16,185,129,.4); color: var(--grn); }
#toast.err { border-color: rgba(239,68,68,.4);  color: var(--red); }

/* â”€â”€ Responsive â”€â”€ */
@media (max-width: 680px) {
  .side { position: fixed; top: 0; left: 0; bottom: 0; transform: translateX(-100%); }
  .side.open { transform: translateX(0); }
  .side-overlay { display: block; }
  .menu-btn { display: block; }
  .cg { grid-template-columns: 1fr; }
  .sg { grid-template-columns: repeat(2, 1fr); }
  .tb-top { flex-direction: column; align-items: flex-start; }
  .search-wrap .si { font-size: 16px; }
  .view { padding: 12px; }
  table { min-width: 400px; }
  .aud-grid { grid-template-columns: 1fr 1fr; }
}
@media (max-width: 400px) {
  .sg { grid-template-columns: 1fr 1fr; }
  .aud-grid { grid-template-columns: 1fr; }
}
@media (min-width: 681px) {
  .ov { align-items: center; padding: 20px; }
  .mo { border-radius: 16px; max-height: 84vh; }
  .mo-handle { display: none; }
}
</style>
</head>
<body>

<!-- Login -->
<div id="login">
  <div class="lcard">
    <div class="lcard-ico">ğŸ›¡ï¸</div>
    <h1>VPN Admin</h1>
    <p>Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ»Ñ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ² Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ</p>
    <input class="linput" type="password" id="pw" placeholder="ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ"
      onkeydown="if(event.key==='Enter')doLogin()">
    <button class="lbtn" onclick="doLogin()">Ğ’Ğ¾Ğ¹Ñ‚Ğ¸</button>
    <div class="lerr" id="lerr"></div>
  </div>
</div>

<!-- App -->
<div id="app">
<div class="shell">
  <div class="side-overlay" id="sov" onclick="closeSidebar()" style="display:none"></div>
  <aside class="side" id="sidebar">
    <div class="brand">
      <div class="brand-ico">ğŸ›¡ï¸</div>
      <div>
        <div class="brand-name">VPN Admin</div>
        <div class="brand-sub">Panel</div>
      </div>
    </div>
    <nav>
      <div class="nav-sec">ĞĞ±Ğ·Ğ¾Ñ€</div>
      <div class="ni on" data-p="dash"      onclick="go('dash')"><span class="ic">ğŸ“Š</span>Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´</div>
      <div class="nav-sec">Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…</div>
      <div class="ni"    data-p="users"     onclick="go('users')"><span class="ic">ğŸ‘¥</span>ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸</div>
      <div class="ni"    data-p="payments"  onclick="go('payments')"><span class="ic">ğŸ’³</span>ĞŸĞ»Ğ°Ñ‚ĞµĞ¶Ğ¸</div>
      <div class="nav-sec">Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹</div>
      <div class="ni"    data-p="broadcast" onclick="go('broadcast')"><span class="ic">ğŸ“¢</span>Ğ Ğ°ÑÑÑ‹Ğ»ĞºĞ°</div>
    </nav>
    <div class="side-foot">
      <button class="out-btn" onclick="doLogout()"><span>ğŸšª</span> Ğ’Ñ‹Ğ¹Ñ‚Ğ¸</button>
    </div>
  </aside>

  <div class="main">
    <div class="topbar">
      <button class="menu-btn" onclick="openSidebar()">â˜°</button>
      <h1 id="ptitle">Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´</h1>
      <span class="status-dot">ĞĞ½Ğ»Ğ°Ğ¹Ğ½</span>
    </div>
    <div class="view" id="view">
      <div class="ld"><div class="sp"></div>Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>
    </div>
  </div>
</div>
</div>

<!-- Modal -->
<div class="ov" id="modal" style="display:none" onclick="if(event.target===this)closeMo()">
  <div class="mo" id="mo-body"></div>
</div>

<!-- Toast -->
<div id="toast"></div>

<script>
'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CORE UTILITIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const $ = id => document.getElementById(id);
let _charts = {};

async function api(path, opts = {}) {
  const r = await fetch('/api' + path, {
    headers: {'Content-Type': 'application/json'},
    ...opts,
    body: opts.body !== undefined ? JSON.stringify(opts.body) : undefined,
  });
  return r.json();
}

function toast(msg, type = 'ok') {
  const el = $('toast');
  el.textContent = msg;
  el.className = `show ${type}`;
  clearTimeout(window._tt);
  window._tt = setTimeout(() => el.className = '', 3200);
}

function openMo(html) { $('mo-body').innerHTML = html; $('modal').style.display = 'flex'; }
function closeMo()    { $('modal').style.display = 'none'; }

function openSidebar() {
  $('sidebar').classList.add('open');
  $('sov').style.display = 'block';
  document.body.style.overflow = 'hidden';
}
function closeSidebar() {
  $('sidebar').classList.remove('open');
  $('sov').style.display = 'none';
  document.body.style.overflow = '';
}

function esc(s) {
  return String(s ?? '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function fmtM(v) {
  return (+(v||0)).toLocaleString('ru-RU', {style:'currency', currency:'RUB', maximumFractionDigits:0});
}
function fmtD(s) {
  if (!s) return 'â€”';
  return new Date(s).toLocaleString('ru-RU',
    {day:'2-digit', month:'2-digit', year:'2-digit', hour:'2-digit', minute:'2-digit'});
}
function fmtDate(s) {
  if (!s) return 'â€”';
  return new Date(s).toLocaleDateString('ru-RU', {day:'2-digit', month:'2-digit', year:'numeric'});
}
function today()    { return new Date().toISOString().slice(0, 10); }
function btnLoad(id){ const el = $(id); if (el) { el.textContent = 'â³'; el.disabled = true; } }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function checkAuth() {
  const d = await api('/me');
  d.logged_in ? showApp() : ($('login').style.display = 'flex');
}
async function doLogin() {
  const d = await api('/login', {method:'POST', body:{password: $('pw').value}});
  d.ok ? showApp() : ($('lerr').textContent = d.error || 'ĞÑˆĞ¸Ğ±ĞºĞ°');
}
async function doLogout() {
  await api('/logout', {method:'POST'});
  $('app').style.display = 'none';
  $('login').style.display = 'flex';
  $('pw').value = '';
}
function showApp() {
  $('login').style.display = 'none';
  $('app').style.display = 'block';
  go('dash');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const TITLES = {dash:'Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´', users:'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸', payments:'ĞŸĞ»Ğ°Ñ‚ĞµĞ¶Ğ¸', broadcast:'Ğ Ğ°ÑÑÑ‹Ğ»ĞºĞ°'};
const PAGES  = {dash:renderDash, users:renderUsers, payments:renderPayments, broadcast:renderBroadcast};

function go(page) {
  closeSidebar();
  document.querySelectorAll('.ni').forEach(el => el.classList.toggle('on', el.dataset.p === page));
  $('ptitle').textContent = TITLES[page] || page;
  (PAGES[page] || (() => {}))();
}
function setView(html) { $('view').innerHTML = html; }
function loading()     { setView('<div class="ld"><div class="sp"></div>Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function renderDash() {
  loading();
  const d = await api('/stats');
  setView(`
    <div class="sg">
      <div class="sc p">
        <div class="sc-emoji">ğŸ‘¥</div>
        <div class="sl">ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹</div>
        <div class="sv">${d.total_users}</div>
        <div class="ss">+${d.new_today} Ğ·Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ</div>
      </div>
      <div class="sc g">
        <div class="sc-emoji">âœ…</div>
        <div class="sl">ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¾Ğº</div>
        <div class="sv">${d.active_subs}</div>
        <div class="ss">${d.expiring} Ğ¸ÑÑ‚ĞµĞºĞ°ÑÑ‚ ÑĞºĞ¾Ñ€Ğ¾</div>
      </div>
      <div class="sc y">
        <div class="sc-emoji">ğŸ’°</div>
        <div class="sl">Ğ’Ñ‹Ñ€ÑƒÑ‡ĞºĞ° Ğ·Ğ° Ğ¼ĞµÑÑÑ†</div>
        <div class="sv">${fmtM(d.revenue_month)}</div>
        <div class="ss">Ğ’ÑĞµĞ³Ğ¾ ${fmtM(d.revenue_total)}</div>
      </div>
      <div class="sc r">
        <div class="sc-emoji">ğŸš«</div>
        <div class="sl">Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾</div>
        <div class="sv">${d.banned}</div>
        <div class="ss">Ğ˜Ğ· ${d.total_users} Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹</div>
      </div>
    </div>
    <div class="cg">
      <div class="cc"><div class="ct">Ğ’Ñ‹Ñ€ÑƒÑ‡ĞºĞ°, 14 Ğ´Ğ½ĞµĞ¹</div><canvas id="cr" height="130"></canvas></div>
      <div class="cc"><div class="ct">Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸, 14 Ğ´Ğ½ĞµĞ¹</div><canvas id="crg" height="130"></canvas></div>
    </div>`);
  mkChart('cr',  d.revenue_chart, '#6366f1');
  mkChart('crg', d.reg_chart,     '#10b981');
}

function mkChart(id, data, color) {
  if (_charts[id]) _charts[id].destroy();
  _charts[id] = new Chart($(id), {
    type: 'line',
    data: {
      labels: data.map(r => String(r.day ?? '').slice(5)),
      datasets: [{
        data: data.map(r => r.total),
        borderColor: color, backgroundColor: color + '18',
        fill: true, tension: .4, pointRadius: 3, pointBackgroundColor: color,
      }],
    },
    options: {
      responsive: true, plugins: {legend:{display:false}},
      scales: {
        x: {grid:{color:'#21253a66'}, ticks:{color:'#555e7a', font:{size:10}}},
        y: {grid:{color:'#21253a66'}, ticks:{color:'#555e7a', font:{size:10}}},
      },
    },
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// USERS â€” list & filters
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const uF = {
  page:1, search:'', pendingSearch:'',
  sub_status:'', banned:'', reg_from:'', reg_to:'', sub_from:'', sub_to:'',
  showFilters: false,
};

async function renderUsers() {
  loading();
  const p = new URLSearchParams({
    page:uF.page, per_page:25,
    search:uF.search, sub_status:uF.sub_status, banned:uF.banned,
    reg_from:uF.reg_from, reg_to:uF.reg_to, sub_from:uF.sub_from, sub_to:uF.sub_to,
  });
  const d  = await api('/users?' + p);
  const tp = Math.ceil(d.total / 25);

  setView(`
    <div class="tc">
      <div class="tb">
        <div class="tb-top">
          <h2>ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ <span class="tb-count">${d.total}</span></h2>
          <div class="tb-row">
            <div class="search-wrap">
              <input class="si" id="usrch" placeholder="ğŸ” Ğ˜Ğ¼Ñ, @username Ğ¸Ğ»Ğ¸ ID"
                value="${esc(uF.pendingSearch)}"
                onkeydown="if(event.key==='Enter'){commitSearch();renderUsers()}">
              <button class="btn btn-acc btn-sm" onclick="commitSearch();renderUsers()">ĞĞ°Ğ¹Ñ‚Ğ¸</button>
            </div>
            <button class="ftgl ${uF.showFilters?'on':''}"
              onclick="uF.showFilters=!uF.showFilters;renderUsers()">
              âš™ Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹${countF()?`<span class="f-count">${countF()}</span>`:''}
            </button>
            ${countF()?`<button class="btn btn-d btn-sm" onclick="resetF()">âœ•</button>`:''}
            <button class="btn btn-d btn-icon" title="ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ" onclick="renderUsers()">â†»</button>
          </div>
        </div>
        ${uF.showFilters ? renderFilterPanel() : ''}
        ${buildChips() ? `<div class="af-chips">${buildChips()}</div>` : ''}
      </div>
      <div class="table-wrap">
        <table>
          <thead><tr>
            <th>ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ</th><th>Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</th><th>ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°</th>
            <th>ĞŸĞ¾Ñ‚Ñ€Ğ°Ñ‡ĞµĞ½Ğ¾</th><th>Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ</th><th></th>
          </tr></thead>
          <tbody>
            ${d.users.map(userRow).join('') ||
              '<tr class="empty-row"><td colspan="6">ĞĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹</td></tr>'}
          </tbody>
        </table>
      </div>
      ${mkPager(uF.page, tp, 'uF.page', 'renderUsers')}
    </div>`);
}

function renderFilterPanel() {
  return `
    <div class="fp">
      <div class="fg">
        <label>ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°</label>
        <select class="fsel" onchange="uF.sub_status=this.value;uF.page=1;renderUsers()">
          <option value="">Ğ›ÑĞ±Ğ°Ñ</option>
          <option value="active"   ${uF.sub_status==='active'  ?'selected':''}>ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ</option>
          <option value="expiring" ${uF.sub_status==='expiring'?'selected':''}>Ğ˜ÑÑ‚ĞµĞºĞ°ĞµÑ‚ (3 Ğ´Ğ½Ñ)</option>
          <option value="expired"  ${uF.sub_status==='expired' ?'selected':''}>Ğ˜ÑÑ‚ĞµĞºĞ»Ğ°</option>
          <option value="no_sub"   ${uF.sub_status==='no_sub'  ?'selected':''}>ĞĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸</option>
        </select>
      </div>
      <div class="fg">
        <label>ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ</label>
        <select class="fsel" onchange="uF.banned=this.value;uF.page=1;renderUsers()">
          <option value="">Ğ’ÑĞµ</option>
          <option value="false" ${uF.banned==='false'?'selected':''}>ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ</option>
          <option value="true"  ${uF.banned==='true' ?'selected':''}>Ğ—Ğ°Ğ±Ğ°Ğ½ĞµĞ½Ğ½Ñ‹Ğµ</option>
        </select>
      </div>
      <div class="fg">
        <label>Ğ”Ğ°Ñ‚Ğ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸</label>
        <div class="date-range">
          <input type="date" class="di" value="${uF.reg_from}" max="${today()}"
            onchange="uF.reg_from=this.value;uF.page=1;renderUsers()">
          <span>â€”</span>
          <input type="date" class="di" value="${uF.reg_to}" max="${today()}"
            onchange="uF.reg_to=this.value;uF.page=1;renderUsers()">
        </div>
      </div>
      <div class="fg">
        <label>Ğ”Ğ°Ñ‚Ğ° Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ¸</label>
        <div class="date-range">
          <input type="date" class="di" value="${uF.sub_from}" max="${today()}"
            onchange="uF.sub_from=this.value;uF.page=1;renderUsers()">
          <span>â€”</span>
          <input type="date" class="di" value="${uF.sub_to}" max="${today()}"
            onchange="uF.sub_to=this.value;uF.page=1;renderUsers()">
        </div>
      </div>
      <div class="fg" style="justify-content:flex-end;margin-top:auto">
        <button class="btn btn-d btn-sm"
          onclick="uF.reg_from=today();uF.reg_to=today();uF.page=1;renderUsers()">
          Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ
        </button>
      </div>
    </div>`;
}

function commitSearch() {
  uF.search = $('usrch')?.value ?? '';
  uF.pendingSearch = uF.search;
  uF.page = 1;
}
function countF() {
  return [uF.search, uF.sub_status, uF.banned, uF.reg_from, uF.reg_to, uF.sub_from, uF.sub_to]
    .filter(Boolean).length;
}
function resetF() {
  Object.assign(uF, {page:1, search:'', pendingSearch:'', sub_status:'',
    banned:'', reg_from:'', reg_to:'', sub_from:'', sub_to:''});
  renderUsers();
}
function buildChips() {
  const c = [];
  const ch = (l, cb) => `<span class="afc">${l}<button onclick="${cb}">Ã—</button></span>`;
  if (uF.search)
    c.push(ch(`Â«${esc(uF.search)}Â»`, "uF.search='';uF.pendingSearch='';uF.page=1;renderUsers()"));
  if (uF.sub_status)
    c.push(ch({active:'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ',expiring:'Ğ˜ÑÑ‚ĞµĞºĞ°ĞµÑ‚',expired:'Ğ˜ÑÑ‚ĞµĞºĞ»Ğ°',no_sub:'ĞĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸'}[uF.sub_status]||uF.sub_status, "uF.sub_status='';uF.page=1;renderUsers()"));
  if (uF.banned)
    c.push(ch(uF.banned==='true'?'Ğ—Ğ°Ğ±Ğ°Ğ½ĞµĞ½Ğ½Ñ‹Ğµ':'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ', "uF.banned='';uF.page=1;renderUsers()"));
  if (uF.reg_from||uF.reg_to)
    c.push(ch(`Ğ ĞµĞ³: ${uF.reg_from||'â€¦'}â€“${uF.reg_to||'â€¦'}`, "uF.reg_from='';uF.reg_to='';uF.page=1;renderUsers()"));
  if (uF.sub_from||uF.sub_to)
    c.push(ch(`ĞŸĞ¾ĞºÑƒĞ¿ĞºĞ°: ${uF.sub_from||'â€¦'}â€“${uF.sub_to||'â€¦'}`, "uF.sub_from='';uF.sub_to='';uF.page=1;renderUsers()"));
  return c.join('');
}

function userRow(u) {
  const hasActive = u.sub_id && u.sub_active && new Date(u.expires_at) > new Date();
  const hasAny    = !!u.sub_id;
  let subActions = '';
  if (!hasAny || !u.sub_active || new Date(u.expires_at) <= new Date())
    subActions = `<button class="btn btn-grn btn-sm" onclick="confirmGrant(${u.user_id},'${esc(u.first_name)}')">ğŸ Ğ’Ñ‹Ğ´Ğ°Ñ‚ÑŒ</button>`;
  else
    subActions = `<button class="btn btn-acc btn-sm" onclick="confirmExtend(${u.user_id},'${esc(u.first_name)}')">â•</button>
                  <button class="btn btn-red btn-sm" onclick="confirmDisable(${u.user_id},'${esc(u.first_name)}')">â¹</button>`;

  return `<tr>
    <td>
      <div style="font-weight:600">${esc(u.first_name||'â€”')}</div>
      <div style="color:var(--txt3);font-size:11px">${u.username?'@'+esc(u.username)+' ':''}<code style="font-size:10px">${u.user_id}</code></div>
    </td>
    <td><span class="bd ${u.is_banned?'r':'g'}">${u.is_banned?'Ğ—Ğ°Ğ±Ğ°Ğ½ĞµĞ½':'ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½'}</span></td>
    <td>${subBadge(u)}</td>
    <td style="white-space:nowrap">${fmtM(u.total_spent)}</td>
    <td style="white-space:nowrap;font-size:11.5px;color:var(--txt2)">${fmtDate(u.registered_at)}</td>
    <td>
      <div class="acts">
        ${subActions}
        <button class="btn btn-d btn-icon btn-sm" onclick="showUser(${u.user_id})" title="ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½ĞµĞµ">Â·Â·Â·</button>
      </div>
    </td>
  </tr>`;
}

function subBadge(u) {
  if (!u.sub_id) return '<span class="bd d">ĞĞµÑ‚</span>';
  const exp = new Date(u.expires_at), now = new Date();
  if (!u.sub_active || exp <= now) return '<span class="bd r">Ğ˜ÑÑ‚ĞµĞºĞ»Ğ°</span>';
  const days = Math.ceil((exp - now) / 86400000);
  return `<div class="sub-col"><span class="bd ${days<=3?'y':'g'}">ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ°</span><span class="sub-days">${days} Ğ´Ğ½.</span></div>`;
}

// â”€â”€ User detail modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function showUser(uid) {
  openMo('<div class="ld"><div class="sp"></div>Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>');
  const d = await api('/users/' + uid);
  if (d.error) { closeMo(); toast(d.error, 'err'); return; }
  const u = d.user;
  const hasActive = u.sub_id && u.sub_active && new Date(u.expires_at) > new Date();

  const subRows = d.subscriptions.slice(0,5).map(s => {
    const ok = s.is_active && new Date(s.expires_at) > new Date();
    return `<tr>
      <td>#${s.id}</td>
      <td style="word-break:break-all"><code style="font-size:10px">${esc(s.marzban_username)}</code></td>
      <td><span class="bd ${ok?'g':'r'}">${ok?'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ°':'Ğ˜ÑÑ‚ĞµĞºĞ»Ğ°'}</span></td>
      <td style="white-space:nowrap">${fmtD(s.expires_at)}</td>
    </tr>`;
  }).join('') || '<tr><td colspan="4" style="text-align:center;color:var(--txt3);padding:12px">â€”</td></tr>';

  const payRows = d.payments.slice(0,5).map(p =>
    `<tr>
      <td><span class="bd ${p.status==='succeeded'?'g':p.status==='pending'?'y':'r'}">${p.status}</span></td>
      <td>${fmtM(p.amount)}</td>
      <td style="white-space:nowrap">${fmtD(p.created_at)}</td>
    </tr>`
  ).join('') || '<tr><td colspan="3" style="text-align:center;color:var(--txt3);padding:12px">â€”</td></tr>';

  openMo(`
    <div class="mo-handle"></div>
    <div class="mo-head">
      <div>
        <div class="mo-title">${esc(u.first_name)}${u.username?' (@'+esc(u.username)+')':''}</div>
        <div class="mo-sub">ID: ${u.user_id}</div>
      </div>
      <button class="mo-x" onclick="closeMo()">âœ•</button>
    </div>
    <div class="ir"><span class="il">Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</span><span class="iv"><span class="bd ${u.is_banned?'r':'g'}">${u.is_banned?'Ğ—Ğ°Ğ±Ğ°Ğ½ĞµĞ½':'ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½'}</span></span></div>
    <div class="ir"><span class="il">ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°</span><span class="iv">${subBadge(u)}</span></div>
    <div class="ir"><span class="il">Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ</span><span class="iv">${fmtD(u.registered_at)}</span></div>
    <div class="ir"><span class="il">ĞŸĞ¾Ñ‚Ñ€Ğ°Ñ‡ĞµĞ½Ğ¾</span><span class="iv">${fmtM(u.total_spent)}</span></div>
    <div class="mo-sect">ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸</div>
    <table class="mini-t">
      <thead><tr><th>ID</th><th>Marzban</th><th>Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</th><th>Ğ˜ÑÑ‚ĞµĞºĞ°ĞµÑ‚</th></tr></thead>
      <tbody>${subRows}</tbody>
    </table>
    <div class="mo-sect">ĞŸĞ»Ğ°Ñ‚ĞµĞ¶Ğ¸</div>
    <table class="mini-t">
      <thead><tr><th>Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</th><th>Ğ¡ÑƒĞ¼Ğ¼Ğ°</th><th>Ğ”Ğ°Ñ‚Ğ°</th></tr></thead>
      <tbody>${payRows}</tbody>
    </table>
    <div class="mo-act">
      ${!hasActive?`<button class="btn btn-grn" onclick="closeMo();confirmGrant(${u.user_id},'${esc(u.first_name)}')">ğŸ Ğ’Ñ‹Ğ´Ğ°Ñ‚ÑŒ</button>`:''}
      ${hasActive ?`<button class="btn btn-acc" onclick="closeMo();confirmExtend(${u.user_id},'${esc(u.first_name)}')">â• ĞŸÑ€Ğ¾Ğ´Ğ»Ğ¸Ñ‚ÑŒ</button>`:''}
      ${hasActive ?`<button class="btn btn-red" onclick="closeMo();confirmDisable(${u.user_id},'${esc(u.first_name)}')">â¹ ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ</button>`:''}
      ${u.is_banned
        ?`<button class="btn btn-grn" onclick="doBan(${u.user_id},false)">âœ“ Ğ Ğ°Ğ·Ğ±Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>`
        :`<button class="btn btn-d" onclick="doBan(${u.user_id},true)"
            style="border-color:rgba(239,68,68,.3);color:var(--red)">ğŸš« Ğ—Ğ°Ğ±Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>`}
      <button class="btn btn-red" onclick="closeMo();confirmDelete(${u.user_id},'${esc(u.first_name)}')">ğŸ—‘ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ</button>
    </div>`);
}

// â”€â”€ Subscription confirmations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function confirmGrant(uid, name) {
  openMo(`
    <div class="mo-handle"></div>
    <div class="confirm-ico">ğŸ</div>
    <div class="mo-title" style="text-align:center;margin-bottom:8px">Ğ’Ñ‹Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ</div>
    <div class="confirm-msg">Ğ‘ÑƒĞ´ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ² Marzban<br>Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ´Ğ»Ñ <b>${esc(name)}</b></div>
    <div class="mo-btns">
      <button class="btn btn-d btn-lg" onclick="closeMo()">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
      <button class="btn btn-grn btn-lg" id="cb" onclick="doGrant(${uid})">âœ“ Ğ’Ñ‹Ğ´Ğ°Ñ‚ÑŒ</button>
    </div>`);
}

function confirmExtend(uid, name) {
  openMo(`
    <div class="mo-handle"></div>
    <div class="confirm-ico">â•</div>
    <div class="mo-title" style="text-align:center;margin-bottom:8px">ĞŸÑ€Ğ¾Ğ´Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ</div>
    <div class="confirm-msg">ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ»ĞµĞ½Ğ° Ğ² Marzban Ğ¸ Ğ‘Ğ”<br>Ğ´Ğ»Ñ <b>${esc(name)}</b></div>
    <div class="mo-btns">
      <button class="btn btn-d btn-lg" onclick="closeMo()">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
      <button class="btn btn-acc btn-lg" id="cb" onclick="doExtend(${uid})">âœ“ ĞŸÑ€Ğ¾Ğ´Ğ»Ğ¸Ñ‚ÑŒ</button>
    </div>`);
}

function confirmDisable(uid, name) {
  openMo(`
    <div class="mo-handle"></div>
    <div class="confirm-ico">â¹</div>
    <div class="mo-title" style="text-align:center;margin-bottom:8px">ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ</div>
    <div class="confirm-msg">ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° <b>${esc(name)}</b> Ğ±ÑƒĞ´ĞµÑ‚ Ğ´ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°</div>
    <label class="chk-row">
      <input type="checkbox" id="del-mz"> Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¸Ğ· Marzban
    </label>
    <div class="mo-btns">
      <button class="btn btn-d btn-lg" onclick="closeMo()">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
      <button class="btn btn-red btn-lg" id="cb" onclick="doDisable(${uid})">âœ“ ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ</button>
    </div>`);
}

function confirmDelete(uid, name) {
  openMo(`
    <div class="mo-handle"></div>
    <div class="confirm-ico">ğŸ—‘</div>
    <div class="mo-title" style="text-align:center;margin-bottom:8px">Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ</div>
    <div class="confirm-msg">
      ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ <b>${esc(name)}</b> (ID: ${uid}) Ğ±ÑƒĞ´ĞµÑ‚ Ğ½Ğ°Ğ²ÑĞµĞ³Ğ´Ğ° ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½<br>
      Ğ¸Ğ· Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ²Ğ¼ĞµÑÑ‚Ğµ ÑĞ¾ Ğ²ÑĞµĞ¼Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°Ğ¼Ğ¸ Ğ¸ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°Ğ¼Ğ¸.
    </div>
    <label class="chk-row">
      <input type="checkbox" id="del-mz-full"> Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¸Ğ· Marzban
    </label>
    <div class="mo-btns">
      <button class="btn btn-d btn-lg" onclick="closeMo()">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
      <button class="btn btn-red btn-lg" id="cb" onclick="doDelete(${uid})">ğŸ—‘ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ</button>
    </div>`);
}

// â”€â”€ Action handlers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function doGrant(uid) {
  btnLoad('cb');
  const d = await api('/users/'+uid+'/sub/grant', {method:'POST', body:{}});
  closeMo();
  d.error ? toast(d.error, 'err') : (toast('âœ… ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ²Ñ‹Ğ´Ğ°Ğ½Ğ°!'), renderUsers());
}
async function doExtend(uid) {
  btnLoad('cb');
  const d = await api('/users/'+uid+'/sub/extend', {method:'POST', body:{}});
  closeMo();
  d.error ? toast(d.error, 'err') : (toast('âœ… ĞŸÑ€Ğ¾Ğ´Ğ»ĞµĞ½Ğ°!'), renderUsers());
}
async function doDisable(uid) {
  const del = $('del-mz')?.checked || false;
  btnLoad('cb');
  const d = await api('/users/'+uid+'/sub/disable', {method:'POST', body:{delete_marzban:del}});
  closeMo();
  d.error ? toast(d.error, 'err') : (toast('ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ°'), renderUsers());
}
async function doBan(uid, banned) {
  const d = await api('/users/'+uid+'/ban', {method:'POST', body:{banned}});
  if (d.ok) { toast(banned?'ğŸš« Ğ—Ğ°Ğ±Ğ°Ğ½ĞµĞ½':'âœ“ Ğ Ğ°Ğ·Ğ±Ğ°Ğ½ĞµĞ½', banned?'err':'ok'); closeMo(); renderUsers(); }
}
async function doDelete(uid) {
  const del = $('del-mz-full')?.checked || false;
  btnLoad('cb');
  const d = await api('/users/'+uid, {method:'DELETE', body:{delete_marzban:del}});
  closeMo();
  d.error ? toast(d.error, 'err') : (toast('ğŸ—‘ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½'), renderUsers());
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PAYMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const pF = {page:1, status:''};

async function renderPayments() {
  loading();
  const d  = await api('/payments?' + new URLSearchParams({page:pF.page, per_page:25, status:pF.status}));
  const tp = Math.ceil(d.total / 25);

  const rows = d.payments.map(p => `<tr>
    <td>
      <div style="font-weight:500">${esc(p.first_name||'â€”')}</div>
      <div style="color:var(--txt3);font-size:11px">${p.username?'@'+esc(p.username)+' ':''}<code style="font-size:10px">${p.user_id}</code></div>
    </td>
    <td><span class="bd ${p.status==='succeeded'?'g':p.status==='pending'?'y':'r'}">${p.status}</span></td>
    <td style="font-weight:600;white-space:nowrap">${fmtM(p.amount)}</td>
    <td style="font-size:10.5px;color:var(--txt3);max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">
      ${esc(p.yukassa_payment_id||'â€”')}
    </td>
    <td style="font-size:11.5px;white-space:nowrap;color:var(--txt2)">${fmtD(p.created_at)}</td>
  </tr>`).join('');

  setView(`
    <div class="tc">
      <div class="tb">
        <div class="tb-top">
          <h2>ĞŸĞ»Ğ°Ñ‚ĞµĞ¶Ğ¸ <span class="tb-count">${d.total}</span></h2>
          <div class="tb-row">
            <select class="fsel" onchange="pF.status=this.value;pF.page=1;renderPayments()">
              <option value="">Ğ’ÑĞµ ÑÑ‚Ğ°Ñ‚ÑƒÑÑ‹</option>
              <option value="succeeded" ${pF.status==='succeeded'?'selected':''}>Ğ£ÑĞ¿ĞµÑˆĞ½Ñ‹Ğµ</option>
              <option value="pending"   ${pF.status==='pending'  ?'selected':''}>ĞĞ¶Ğ¸Ğ´Ğ°ÑÑ‰Ğ¸Ğµ</option>
              <option value="canceled"  ${pF.status==='canceled' ?'selected':''}>ĞÑ‚Ğ¼ĞµĞ½Ñ‘Ğ½Ğ½Ñ‹Ğµ</option>
            </select>
            <button class="btn btn-d btn-icon" title="ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ" onclick="renderPayments()">â†»</button>
          </div>
        </div>
      </div>
      <div class="table-wrap">
        <table>
          <thead><tr>
            <th>ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ</th><th>Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</th><th>Ğ¡ÑƒĞ¼Ğ¼Ğ°</th><th>Ğ®Kassa ID</th><th>Ğ”Ğ°Ñ‚Ğ°</th>
          </tr></thead>
          <tbody>${rows || '<tr class="empty-row"><td colspan="5">ĞĞµÑ‚ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶ĞµĞ¹</td></tr>'}</tbody>
        </table>
      </div>
      ${mkPager(pF.page, tp, 'pF.page', 'renderPayments')}
    </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BROADCAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const AUDIENCES = [
  {key:'all',        name:'Ğ’ÑĞµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸',  desc:'Ğ’ÑĞµ Ğ½ĞµĞ·Ğ°Ğ±Ğ°Ğ½ĞµĞ½Ğ½Ñ‹Ğµ'},
  {key:'active',     name:'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°', desc:'ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ° Ğ¿Ñ€ÑĞ¼Ğ¾ ÑĞµĞ¹Ñ‡Ğ°Ñ'},
  {key:'expiring',   name:'Ğ˜ÑÑ‚ĞµĞºĞ°ĞµÑ‚ ÑĞºĞ¾Ñ€Ğ¾',    desc:'Ğ˜ÑÑ‚ĞµĞºĞ°ĞµÑ‚ Ğ² Ğ±Ğ»Ğ¸Ğ¶. 3 Ğ´Ğ½Ñ'},
  {key:'expired',    name:'ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ¸ÑÑ‚ĞµĞºĞ»Ğ°',  desc:'Ğ‘Ñ‹Ğ»Ğ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°, ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°'},
  {key:'no_sub',     name:'Ğ‘ĞµĞ· Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸',      desc:'ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğµ Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°Ğ»Ğ¸'},
  {key:'no_payment', name:'Ğ‘ĞµĞ· Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶ĞµĞ¹',      desc:'Ğ—Ğ°Ñ€ĞµĞ³., Ğ½Ğ¾ Ğ½Ğ¸ Ñ€Ğ°Ğ·Ñƒ Ğ½Ğµ Ğ¿Ğ»Ğ°Ñ‚Ğ¸Ğ»Ğ¸'},
  {key:'paid_once',  name:'Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ 1 Ğ¿Ğ»Ğ°Ñ‚Ñ‘Ğ¶',   desc:'ĞšÑƒĞ¿Ğ¸Ğ»Ğ¸ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ· â€” Ğ½Ğµ Ğ²ĞµÑ€Ğ½ÑƒĞ»Ğ¸ÑÑŒ'},
];
let bAud    = 'all';
let bCounts = {};

async function renderBroadcast() {
  loading();
  const counts = await Promise.all(AUDIENCES.map(a => api('/broadcast/count?audience=' + a.key)));
  AUDIENCES.forEach((a, i) => { bCounts[a.key] = counts[i]?.count ?? '?'; });
  _renderBroadcastUI();
}

function _renderBroadcastUI() {
  const cards = AUDIENCES.map(a => `
    <div class="aud-card ${bAud===a.key?'sel':''}" onclick="bAud='${a.key}';_renderBroadcastUI()">
      <div class="aud-name">${a.name}</div>
      <div class="aud-desc">${a.desc}</div>
      <div class="aud-count">${bCounts[a.key] ?? 'â€¦'} Ñ‡ĞµĞ».</div>
    </div>`).join('');

  setView(`
    <div class="tc bpage" style="padding:22px">
      <h2>Ğ Ğ°ÑÑÑ‹Ğ»ĞºĞ°</h2>
      <p class="hint">ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ HTML: &lt;b&gt;, &lt;i&gt;, &lt;code&gt;, &lt;a href&gt;</p>
      <textarea class="bcast-ta" id="bt" placeholder="Ğ¢ĞµĞºÑÑ‚ Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ¸..."></textarea>
      <div class="aud-label">ĞÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ</div>
      <div class="aud-grid">${cards}</div>
      <div class="bcast-footer">
        <button class="btn btn-primary btn-lg" id="sbtn" onclick="sendBroadcast()">
          ğŸ“¤ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ
        </button>
        <span class="bcast-total">ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ĞµĞ»ĞµĞ¹: <b>${bCounts[bAud] ?? 'â€¦'}</b></span>
      </div>
      <div id="bres" style="display:none"></div>
    </div>`);
}

async function sendBroadcast() {
  const text = $('bt')?.value?.trim();
  if (!text) { toast('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚ĞµĞºÑÑ‚', 'err'); return; }
  const btn = $('sbtn');
  btn.textContent = 'â³ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ°...'; btn.disabled = true;
  const d = await api('/broadcast', {method:'POST', body:{text, audience:bAud}});
  btn.textContent = 'ğŸ“¤ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ'; btn.disabled = false;
  if (d.error) { toast(d.error, 'err'); return; }
  const el = $('bres');
  el.style.display = 'block';
  el.className = 'bcast-ok';
  el.innerHTML = `âœ… ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾: <b>${d.sent}</b>, Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº: <b>${d.failed}</b>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PAGINATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function mkPager(page, total, varName, fn) {
  if (total <= 1) return '';
  const btns = [];
  const s = Math.max(1, page - 2), e = Math.min(total, page + 2);
  if (s > 1)
    btns.push(`<button class="pb" onclick="${varName}=1;${fn}()">1</button>${s>2?'<span class="ptxt">â€¦</span>':''}`);
  for (let i = s; i <= e; i++)
    btns.push(`<button class="pb ${i===page?'on':''}" onclick="${varName}=${i};${fn}()">${i}</button>`);
  if (e < total)
    btns.push(`${e<total-1?'<span class="ptxt">â€¦</span>':''}<button class="pb" onclick="${varName}=${total};${fn}()">${total}</button>`);
  return `<div class="pg">
    <button class="pb" onclick="${varName}=Math.max(1,${page}-1);${fn}()" ${page<=1?'disabled':''}>â†</button>
    ${btns.join('')}
    <button class="pb" onclick="${varName}=Math.min(${total},${page}+1);${fn}()" ${page>=total?'disabled':''}>â†’</button>
  </div>`;
}

// â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
checkAuth();
</script>
</body>
</html>
